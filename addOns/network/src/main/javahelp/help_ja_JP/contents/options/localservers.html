<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<TITLE>ローカルサーバー/プロキシ</TITLE>
</HEAD>
<BODY>
	<H1>ローカルサーバー/プロキシ</H1>

	<H2>ローカルサーバー/プロキシ</H2>
	このタブでは、ZAPが着信接続を受け入れるアドレスとポートを設定できます。

	<H3>メインプロキシ</H3>
	デフォルトでは、ZAPは1つのローカルアドレスとポートで待機します。通常、これらがブラウザでプロキシとして使用するように設定すべきアドレスとポートです。 

	<H3>追加サーバー/プロキシ</H3>
	ZAPが待機する追加のアドレスとポートを好きなだけ追加できます。<br>
これは、モバイルアプリケーションをテストするときに役立ちます。モバイルユーザーエージェントをエミュレートするブラウザを使用して、ZAPを介してプロキシすることでバックエンドサイトを直接使用すると同時に、Wi-Fiインターフェースを介してモバイルアプリケーションをプロキシできます。

	<H3>サーバー/プロキシのプロパティ</H3>
	メインプロキシと追加のサーバー/プロキシの両方で、以下のプロパティを設定できます。

	<H4>アドレス</H4>
	バインドするローカルアドレス。 利用可能なすべてのアドレスが自動的に識別されます。

	<H4>ポート</H4>
	サーバー/プロキシが待機するポート。

	<H4>セキュリティプロトコル</H4>
	着信接続 (例: ブラウザから) で有効にするSSL/TLSバージョンを選択できます。 少なくとも1つのバージョンを有効にする必要があり、JREでサポートされていないバージョンは選択解除され、無効になります。
	<br>
SSLv2Helloオプションは、少なくとも1つのSSL/TLSバージョンと組み合わせて選択する必要があります。

	<H4>ALPN</H4>
	TLSハンドシェイク中にネゴシエートされるアプリケーションプロトコル (ALPN拡張) を有効にして選択できます。<br>
	<strong>注:</strong> 接続を確立するクライアントがALPNまたは選択されたプロトコルのいずれもサポートしていない場合、プロトコルはHTTP/1.1にフォールバックします。

	<H4>モード</H4>
	APIを公開するか、プロキシリクエストを許可するかを指定できます。 たとえば、ローカルアドレス専用のプロキシを持ちながら、外部アドレスにAPIのみを公開するサーバー (つまり、リモートコントロール) を設定できます。

	<H4>NATの背後</H4>
	サーバー/プロキシ (ZAP) がNATの背後にあることを示します。 選択すると、ZAPはパブリックIPアドレスを特定しようとします。これにより、パブリックIPアドレスを持つリクエストを適切に検出および処理します (ZAP APIによる処理など)。 または、IPアドレスをエイリアスとして手動で追加することもできます (「エイリアス」セクションを参照)。
	<p>
	<strong>注:</strong> このオプションは、ZAPがAWS EC2インスタンスで実行されている場合にのみサポートされます。
	ZAPは、<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html#working-with-ip-addresses">AWS EC2インスタンスのメタデータ</a>からパブリックIPアドレスを取得します。<br>
パブリックIPアドレスを介したAPIへのアクセスが必要な場合は、このオプションを有効にしてZAPを起動する必要があります。
	<blockquote>zap.sh -daemon -port 8080 -host 0.0.0.0 -config network.localServers.mainProxy.behindNat=true</blockquote>
	<br>
	また、APIは外部IPアドレス (つまり、ZAPにアクセスしているIPアドレス) を受け入れるように設定する必要があります。

	<H4>Accept-Encoding リクエストヘッダーを削除する</H4>
	プロキシが「Accept-Encoding」リクエストヘッダーフィールドを削除することを許可します。これにより、レスポンスに対して (サポートされていない) エンコーディング変換が適用されることを防ぎます。<br/>
このオプションはエンコーディング変換をテストする場合を除いて、常に有効にする必要があります。<br/>
サポートされていないエンコーディングでエンコードされたメッセージは、(パッシブスキャナーまたはアクティブスキャナーのいずれによっても) 正しくスキャンされません。<br/>
サポートされているコンテンツエンコーディング：
	<ul>
		<li><code>br</code>, Linux x64、macOS (IntelおよびApple Silicon)、およびWindows x64</li>
		<li><code>deflate</code></li>
		<li><code>gzip</code></li>
	</ul>

	<H4>レスポンスのデコード</H4>
	プロキシがレスポンスを自動的にデコード (つまり、gzip、deflate) することを許可します。 このオプションは「Accept-Encoding」リクエストヘッダーフィールドを無視するアプリケーションに必要です。

	<H3>インターセプティング/透過型プロキシ</H3>
	ローカルプロキシはHTTPとHTTPSの両方でインターセプティング/透過型プロキシとして使用できます。 HTTPSの場合、クライアントアプリケーション (例: ブラウザ) はTLS拡張 <a href="https://tools.ietf.org/html/rfc6066#section-3">Server Name Indication</a> を使用する必要があります。
	これにより、ソフトウェア設定に関係なく、すべてのHTTPおよびHTTPSトラフィックがプロキシされるテストLAN (またはVM) を設定できます。
	<p>
	たとえば、テストに使用するLinuxマシンがある場合、以下のようにして、すべてのHTTPおよびHTTPSトラフィックを<code>192.168.0.14:8080</code>で待機しているローカルプロキシに転送できます。
	<pre><code>iptables -t nat -A OUTPUT -p tcp --dport 443 -j DNAT --to-destination 192.168.0.14:8080
iptables -t nat -A OUTPUT -p tcp --dport 80 -j DNAT --to-destination 192.168.0.14:8080
	</code></pre>

	<H2>エイリアス</H2>
	ローカルサーバー/プロキシを他の名前 (ドメインまたはアドレス) で識別することを許可します。 たとえば、パブリックIPアドレスでZAP APIにアクセスするため。

	<H2>パススルー</H2>
	ZAPをパススルーするオーソリティ (ドメイン/アドレスとポート) を設定することを許可し、データを復号化/暗号化せずに送信します。
	これは、クライアントが特定のホストに対して証明書ピン留めを行っている場合や、ドメイン/データがテスト対象のターゲットに関係ない場合に役立ちます。
	<p>クライアントが必要なオーソリティを含む CONNECT リクエストを送信する必要があります。 <code>authority</code> は正規表現として解釈され、要求されたオーソリティ (権限情報) に含まれている必要があります。
	<br>
たとえば、<code>example.org</code>へのすべての接続をパススルーするには、<code>example.org</code>のみを指定でき、それにより任意のポートに一致します。
	<p>ホストのすべてのトラフィックがテストに関連しない場合、パススルーを使用することは、除外 (例: プロキシからの除外、グローバル除外URL) を使用するよりも効率的です。

	<H2>関連情報</H2>
	<table>
		<tr>
			<td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
			<td><a href="../network.html">ネットワーク</a></td>
			<td>ネットワークアドオンの概要</td>
		</tr>
	</table>

</BODY>
</HTML>
